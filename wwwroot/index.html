<html>
    <head>
        <title>reFUSE</title>
        <script src="js/api.js" type="text/javascript"></script>
    </head>
    <body>
        <h1>reFUSE</h1>
        <hr />
        <select id="lstVoices"></select>
        <script type="text/javascript">
            var lstVoices = document.getElementById("lstVoices");
            apiCall("patches", {})
                .then((response) => {
                    console.log(response);
                    ProcessPatches(response);
                })
                .catch((error) => {
                    console.error(error);
                });

            function ProcessPatches(patches) {
                for(var patch in patches) {
                    var p = new Patch(patch, patches[patch]);
                    lstVoices.appendChild(p.optionElement);
                    document.body.appendChild(p.element);
                }
            }

            function Patch(index, patchData) {
                var option = document.createElement('option');
                option.value = index;
                option.innerText = patchData.Name;
                this.optionElement = option;
                this.element = document.createElement('div');
                var header = document.createElement('h1');
                header.innerText = patchData.Name;
                this.element.appendChild(header);
                for(var i = 0; i < patchData.Modules.length; i++) {
                    var module = new Module(patchData.Modules[i]);
                    this.element.appendChild(module.element);
                }
            }

            function Module(moduleData) {
                this.element = document.createElement('div');
                for(var obj in moduleData) {
                    if(!isNaN(moduleData[obj])) {
                        var control = new NumberControl(moduleData, obj);
                        this.element.appendChild(control.element);
                    }
                }
            }

            function NumberControl(obj, dataName) {
                this.element = document.createElement('div');
                var label = document.createElement('label');
                var txtInput = document.createElement('input');
                label.innerText = dataName;
                this.element.appendChild(label);
                this.element.appendChild(txtInput);
                txtInput.value = obj[dataName];
            }
        </script>
    </body>
</html>